global:
    key_text: ""
    value_text: ""
    filter: |
        function () {
            return global.key_text && global.value_text &&
                String(feature[global.key_text]).toLowerCase().indexOf(global.value_text.toLowerCase()) > -1;
        }
    feature_order: function() { return feature.sort_key; }
    red-lines:
        filter: global.filter
        draw:
            lines:
                order: 1000
                color: red
                width: 3px
            text:
                text_source: name
                font:
                    size: 8pt
                    family: Lucida Grande
                    fill: white
    landuse-filters:
        any:
            # show labels for smaller landuse areas at higher zooms
            - { $zoom: { min: 9 },  area: { min: 100000000 } }
            - { $zoom: { min: 10 }, area: { min: 100000000 } }
            - { $zoom: { min: 11 }, area: { min: 25000000 } }
            - { $zoom: { min: 12 }, area: { min: 5000000 } }
            - { $zoom: { min: 13 }, area: { min: 2000000 } }
            - { $zoom: { min: 14 }, area: { min: 100000 } }
            - { $zoom: { min: 15 }, area: { min: 50000 } }
            - { $zoom: { min: 15 }, area: { min: 10000 } }
            - { $zoom: { min: 18 } }
scene:
    background:
        color: [.4, .4, .4]

camera:
    type: isometric

lights:
    light1:
        type: directional
        diffuse: 1
        ambient: .35

sources:
    osm:
        type: TopoJSON
        url: https://vector.mapzen.com/osm/all/{z}/{x}/{y}.topojson?api_key=vector-tiles-HqUVidw
        max_zoom: 16

layers:
    earth:
        data: { source: osm }
        draw:
            polygons:
                interactive: true
                order: global.feature_order
                color: [.5, .5, .5]
        red: global.red-lines

    landuse:
        data: { source: osm }
        draw:
            polygons:
                interactive: true
                order: global.feature_order
                color: [.6, .6, .6]
        red: global.red-lines

    water:
        data: { source: osm }
        draw:
            polygons:
                interactive: true
                order: global.feature_order
                color: [.4, .4, .4]
            lines:
                order: global.feature_order
                color: [.5, .5, .5]
                width: 1px
        red: global.red-lines

    roads:
        data: { source: osm }
        draw:
            lines:
                interactive: true
                order: global.feature_order
                color: '#bbb'
                width: 1px
        red: global.red-lines

    transit:
        data: { source: osm }
        draw:
            lines:
                interactive: true
                order: global.feature_order
                color: '#bbb'
                width: 2px
        red: global.red-lines

    buildings:
        data: { source: osm }
        draw:
            polygons:
                interactive: true
                order: global.feature_order
                color: '#888'
        red: global.red-lines

    places:
        data: { source: osm }
        draw:
            points:
                interactive: true
                order: global.feature_order
                color: '#444'
                size: 12px
        red:
            filter: global.filter
            draw:
                points:
                    interactive: true
                    color: '#f88'
                    size: 14px
                text:
                    collide: false
                    anchor: bottom
                    offset: [0, 7px]
                    font:
                        size: 8pt
                        family: Lucida Grande
                        fill: white

    pois:
        data: { source: osm }
        filter: { $zoom: { min: 15 } }
        draw:
            points:
                interactive: true
                color: '#555'
                size: 10px
        red:
            filter: global.filter
            draw:
                points:
                    interactive: true
                    color: '#f88'
                    size: 10px
                text:
                    collide: false
                    anchor: bottom
                    offset: [0, 7px]
                    font:
                        size: 8pt
                        family: Lucida Grande
                        fill: white

    landuse_labels:
        data: { source: osm }
        filter: global.landuse-filters  
        draw:
            points:
                interactive: true
                order: global.feature_order
                color: '#888'
                size: 8px
            text:
                font:
                    size: 8pt
                    family: Helvetica
                    fill: '#ccc'
        red:
            filter: global.filter
            draw:
                points:
                    interactive: true
                    order: 1000
                    color: '#c88'
                    size: 10px
                text:
                    font:
                        fill: red
